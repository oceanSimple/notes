# â™¾ï¸æ§åˆ¶äººç‰©ç§»åŠ¨
## ğŸ’«åˆ›å»ºæ§åˆ¶ç³»ç»Ÿ
- åˆ›å»ºinput actions
![[Pasted image 20250320141316.png|400]]

- æ‰“å¼€GameController
- æ³¨æ„, action typeè®¾ç½®ä¸º`value`
![[Pasted image 20250320141656.png|600]]

- æ·»åŠ ä¸Šä¸‹å·¦å³æ¡ˆä»¶
![[Pasted image 20250320141739.png]]

- æ•ˆæœå¦‚ä¸‹
![[Pasted image 20250320142638.png]]


- è®°å¾—ç”Ÿæˆcsæ–‡ä»¶
![[Pasted image 20250320142352.png|400]]

## ğŸ’«ç§»åŠ¨-ä»£ç éƒ¨åˆ†
- åˆ›å»º`GameInput.cs`
```csharp
public class GameInput : MonoBehaviour {
    private GameController gameController;

    private void Awake() {
        // å¯ç”¨player map
        gameController = new GameController();
        gameController.Player.Enable();
    }

    public Vector3 GetMovementDirectionNormalized() {
        // è·å–è¾“å…¥çš„äºŒç»´å‘é‡
        var inputVector2 = gameController.Player.Move.ReadValue<Vector2>();
        // å°†äºŒç»´å‘é‡è½¬æ¢ä¸ºä¸‰ç»´å‘é‡
        var direction = new Vector3(inputVector2.x, 0, inputVector2.y);
        // å½’ä¸€åŒ–å‘é‡, ä½¿å…¶é•¿åº¦ä¸º1
        direction = direction.normalized;
        return direction;
    }
}
```

- åˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“, å°†`GameInput.cs`ç»‘å®š
![[Pasted image 20250320145102.png|525]]


- `Player.cs`
```csharp
public class Player : MonoBehaviour {
    [SerializeField] private GameInput gameInput;

    private float moveSpeed = 5f;

    void Start() {

    }

    void Update() {
        HandleMovement();
    }

    private void HandleMovement() {
        var direction = gameInput.GetMovementDirectionNormalized();


        // æ ¹æ®è¾“å…¥æ–¹å‘ç§»åŠ¨ç©å®¶ï¼Œé€Ÿåº¦ä¸ºæ¯ç§’5ä¸ªå•ä½
        transform.position += direction * Time.deltaTime * moveSpeed;
    }
}
```

è®°å¾—å°†æŒ‚è½½GameInputçš„å¯¹è±¡, æŒ‚è½½åˆ°Playerçš„gameInputä¸Š

## ğŸ’«æœå‘
```csharp
// ä½¿è§’è‰²é¢æœç§»åŠ¨æ–¹å‘
if (transform.forward != Vector3.zero) {
transform.forward = Vector3.Slerp(transform.forward, direction, Time.deltaTime * rotateSpeed);
}
```

â€¢	ä½¿ç”¨ Vector3.Lerp è¿›è¡Œçº¿æ€§æ’å€¼ï¼Œé€‚ç”¨äºä½ç½®è¿‡æ¸¡ã€‚
â€¢	ä½¿ç”¨ Vector3.Slerp è¿›è¡Œçƒé¢çº¿æ€§æ’å€¼ï¼Œé€‚ç”¨äºæ–¹å‘è¿‡æ¸¡ã€‚

## ğŸ’«ç¢°æ’
- ç»™Playerå®‰è£…`Collider`ç»„ä»¶
	- ps: æœ‰å¤šç§å½¢çŠ¶çš„ç»„ä»¶, å¦‚box, capsuleç­‰
	- è°ƒæ•´å¤§å°å’Œä½ç½®, åŒ…è£¹ä½Player
![[Pasted image 20250320181511.png|350]]

- åŒæ—¶, å…¶ä»–ç‰©ä½“ä¹Ÿè¦åŠ ä¸Š`Collider`ç»„ä»¶
- ç„¶åç»™PlayeråŠ ä¸Š`Rigidbody`ç»„ä»¶
	- æ³¨æ„å¯ä»¥å–æ¶ˆå‹¾é€‰`use gravity`

![[Pasted image 20250320181858.png|350]]

- æœ€å, å°†ç§»åŠ¨å¤„ç†å‡½æ•°æ”¾åœ¨`FixedUpdate`ä¸­
```csharp
    private void FixedUpdate() {
        HandleMovement();
    }
```


## ğŸ’«æ€»ç»“
### ä½ç½®æ§åˆ¶å’ŒåŠ¨ç”»æ§åˆ¶

> ä¸ºäº†ä¸å‡ºç°é—®é¢˜, æˆ‘ä»¬é€šå¸¸å°†ä½ç½®æ§åˆ¶å’ŒåŠ¨ç”»æ§åˆ¶åˆ†ç¦»
> ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡, å°†playerä½œä¸ºå­å¯¹è±¡æ”¾å…¥çˆ¶å¯¹è±¡ä¸­

![[Pasted image 20250320172529.png]]

- æˆ‘ä»¬å°†æ§åˆ¶ç§»åŠ¨çš„è„šæœ¬æŒ‚è½½åˆ°Playerä¸Š
![[Pasted image 20250320172559.png]]


```ad-warning
æ³¨æ„, è¿™ä¸¤ä¸ªå¯¹è±¡ä½ç½®åæ ‡ä¸€å®šä¸€å®šè¦é‡åˆå“¦!!!
```


# â™¾ï¸Animation
- åˆ›å»ºåŠ¨ç”»
![[Pasted image 20250320202247.png]]

- è¿çº¿
![[Pasted image 20250320202302.png]]

- è®¾ç½®çŠ¶æ€è½¬æ¢æ ‡è¯†
![[Pasted image 20250320202553.png]]


- ç¼–å†™`PlayerAnimator`è„šæœ¬
```csharp
public class PlayerAnimator : MonoBehaviour {
    private const string IS_WALKING = "Is_Walking";
    [SerializeField] private Player player;
    private Animator anim;
    // Start is called once before the first execution of Update after the MonoBehaviour is created
    void Start() {
        // æ³¨å†Œanimatorç»„ä»¶
        anim = GetComponent<Animator>();
    }

    // Update is called once per frame
    void Update() {
       anim.SetBool(IS_WALKING, player.IsWalking);
    }
}
```

- åœ¨`Player`æ·»åŠ çŠ¶æ€å±æ€§
```csharp
public class Player : MonoBehaviour {
    private bool isWalking = false;
    public bool IsWalking {
        get { return isWalking; }
    }

    private void FixedUpdate() {
        HandleMovement();
    }

    private void HandleMovement() {
        var direction = gameInput.GetMovementDirectionNormalized();

        // åˆ¤æ–­ç©å®¶æ˜¯å¦åœ¨èµ°è·¯
        isWalking = (direction != Vector3.zero);
    }
}
```

- å°†`PlayerAnimator`æŒ‚è½½åˆ°PlayerVisualä¸Š, åŒæ—¶æŒ‚è½½`Player`å¯¹è±¡
![[Pasted image 20250320204816.png]]


# â™¾ï¸äº¤äº’
## ğŸ’«å‡½æ•°ä»‹ç»
Physics.Raycast
https://docs.unity3d.com/cn/2022.3/ScriptReference/Physics.Raycast.html

- å‘åœºæ™¯ä¸­çš„æ‰€æœ‰ç¢°æ’ä½“æŠ•å°„ä¸€æ¡å°„çº¿ï¼Œè¯¥å°„çº¿èµ·ç‚¹ä¸º /origin/ï¼Œæœå‘ /direction/ï¼Œé•¿åº¦ä¸º /maxDistance/ã€‚
- è¿”å›å€¼: bool

```csharp
Physics.Raycast(transform.position, transform.forward, out RaycastHit hitinfo, 2f)
```
- transform.position: èµ·ç‚¹
- transform.forward: æœå‘
- out RaycastHit hitinfo: ç¢°æ’ä½“çš„ä¿¡æ¯
- 2f: è·ç¦»


## ğŸ’«ä¸¾ä¾‹: ä¸cubeäº¤äº’
- åˆ›å»º`Cube`è„šæœ¬
```csharp
public class Cube : MonoBehaviour {
    public void Interact() {
        print(this.gameObject + "is interacting ... ");
    }
}
```

- ç›‘å¬æ˜¯å¦æœ‰äº¤äº’
```csharp
private void FixedUpdate() {
	HandleMovement();
	HandleInteraction();
}
    
private void HandleInteraction() {
	// åˆ¤æ–­ç‰©ä½“è§†çº¿å‰æ–¹æ˜¯å¦æœ‰ç‰©ä½“
	if (Physics.Raycast(transform.position, transform.forward, out RaycastHit hitinfo, 2f)) {
		// å°è¯•è·å–ç‰©ä½“ä¸Šçš„Cubeç»„ä»¶
		if (hitinfo.transform.TryGetComponent<Cube>(out Cube cube)) {
			cube.Interact();
		}
	}
}
```

- è®°å¾—ç»™Cubeå¯¹è±¡ç»‘å®šcubeè„šæœ¬!


## ğŸ’«æŒ‰é”®äº¤äº’
- æ·»åŠ æŒ‰é”®æ“ä½œ
![[Pasted image 20250321083346.png]]

- åœ¨`GameInput`è„šæœ¬ä¸­
```csharp
private void Awake() {
	// å¯ç”¨player map
	gameController = new GameController();
	gameController.Player.Enable();

	// ç»™Player.Interactçš„æŒ‰é’®åŠ ä¸Šäº‹ä»¶å‡½æ•°
	// å½“ç›‘å¬åˆ°æŒ‰é’®æ—¶, è°ƒç”¨Interact_Performedå‡½æ•°
	gameController.Player.Interact.performed += Interact_Performed;
}

private void Interact_Performed(UnityEngine.InputSystem.InputAction.CallbackContext obj) {
	OnInteractAction?.Invoke(this, EventArgs.Empty);
}
```

- æˆ‘ä»¬å¸¸ç”¨`event`æ–¹æ³•
	- åœ¨`GameInput`åˆ›å»ºeventäº‹ä»¶
	```csharp
	public event EventHandler OnInteractAction;
	```
	- è°ƒç”¨Invoke
	```csharp
OnInteractAction?.Invoke(this, EventArgs.Empty);
```
	- åœ¨`Player`ä¸­åˆ›å»ºè°ƒç”¨å‡½æ•°
	```csharp
void Start() {
	gameInput.OnInteractAction += GameInput_OnInteractAction;
}

private void GameInput_OnInteractAction(object sender, System.EventArgs e) {
	HandleInteraction();
}
```

- è§£é‡Šé€»è¾‘
	- å½“æˆ‘ä»¬æŒ‰ä¸‹`e`é”®æ—¶, ç›¸å½“äºè§¦å‘äº†æŒ‰é’®äº‹ä»¶
	- ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨`GameInput`ä¸­ `Interact_Performed` å‡½æ•°
	- è€Œ`Interact_Performed`å‡½æ•°ä¼šè°ƒç”¨äº‹ä»¶`OnInteractAction`
	- å³è°ƒç”¨`Player`ä¸­æ³¨å†Œçš„`GameInput_OnInteractAction`å‡½æ•°
- æ€»çš„æ¥è¯´å°±æ˜¯, æœ‰ä¸¤ä¸ªäº‹ä»¶è°ƒç”¨
	- ç¬¬ä¸€ä¸ªäº‹ä»¶æ˜¯é€šè¿‡æŒ‰é”®eè§¦å‘
	- ç¬¬äºŒä¸ªäº‹ä»¶æ˜¯é€šè¿‡ç¬¬ä¸€ä¸ªäº‹ä»¶çš„å‡½æ•°è°ƒç”¨, å»è¿è¡ŒPlayerä¸­å®šä¹‰çš„å‡½æ•°
















































